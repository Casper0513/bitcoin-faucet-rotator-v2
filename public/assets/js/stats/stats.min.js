function generateVisitorsTable(e,t){if(void 0!==e&&void 0!==$(t))return $(t).DataTable({processing:!0,data:e,language:{processing:"Loading..."},order:[[1,"desc"],[2,"desc"],[3,"desc"],[4,"desc"],[5,"desc"],[6,"asc"],[7,"desc"]],columns:[{data:"url",type:"string",render:{_:function(e){var t='<a href="'+e.display+'" title="'+e.original+'">';return t+=e.original+"</a>"},sort:"original"}},{data:"uniqueVisitors",type:"num",render:{_:"display",sort:"original"}},{data:"pageViews",type:"num",render:{_:"display",sort:"original"}},{data:"uniquePageViews",type:"num",render:{_:"display",sort:"original"}},{data:"aveSessionDuration",type:"num",render:{_:"display",sort:"original"}},{data:"aveTimeOnPage",type:"num",render:{_:"display",sort:"original"}},{data:"noOfBounces",type:"num",render:{_:"display",sort:"original"}},{data:"noOfCountries"}],responsive:!0,scrollX:!0,fnStateSave:function(e,t){localStorage.setItem("VisitorsDataTable",JSON.stringify(t))},fnStateLoad:function(e){return JSON.parse(localStorage.getItem("VisitorsDataTable")).iStart=0,e}})}function generateVisitorsLineChart(e,t){var a=getRandomRgb(),r=getRandomRgb();if(void 0!==e&&"error"!==e.status&&void 0!==$(t)[0]){var s=$(t)[0].getContext("2d"),o=[],n=[],i=[];e.forEach(function(e){o.push(new Date(e.date).formatDDMMYYYY()),n.push(parseInt(e.visitors)),i.push(parseInt(e.pageViews))});var l={type:"line",data:{labels:o,datasets:[{label:"Visitors",borderColor:rgbaString(a.r,a.g,a.b),backgroundColor:rgbaString(a.r,a.g,a.b,.5),data:n},{label:"Page views",borderColor:rgbaString(r.r,r.g,r.b),backgroundColor:rgbaString(r.r,r.g,r.b,.5),data:i}]},options:{showScale:!0,scaleShowGridLines:!0,scaleGridLineColor:"rgba(0,0,0,.05)",scaleGridLineWidth:1,scaleShowHorizontalLines:!0,scaleShowVerticalLines:!0,bezierCurve:!0,bezierCurveTension:.8,pointDot:!1,pointDotRadius:4,pointDotStrokeWidth:1,pointHitDetectionRadius:20,datasetStroke:!0,datasetStrokeWidth:2,datasetFill:!0,maintainAspectRatio:!0,responsive:!0,tooltips:{mode:"index",intersect:!1,callbacks:{label:function(e,t){return 0===e.datasetIndex?"Visitors: "+e.yLabel.toString():1===e.datasetIndex?"Page Views: "+e.yLabel.toString():void 0}}},scales:{yAxes:[{scaleLabel:{display:!0,labelString:"Number of Visitors / Page Views"}}],xAxes:[{scaleLabel:{display:!0,labelString:"Date"}}]}}};return new Chart(s,l)}}function getVisitorsDataAjax(e,t,a,r){if(null===r&&(r=10),null!==e&&null!==t&&null!==a){var s=laroute.route(e,{dateFrom:t,dateTo:a,quantity:r});return void 0===s?null:$.get(s,function(e){return e.data}).promise()}}function getBrowserStatsAjax(e,t,a,r){if(null===r&&(r=10),null!==e&&null!==t&&null!==a){var s=laroute.route(e,{dateFrom:t,dateTo:a,maxBrowsers:r});return $.get(s,function(e){return e.data}).promise()}}function generatePieDonutChart(e,t){if(void 0!==e&&void 0!==$(t)){var a;if("."===t.charAt(0))a=document.getElementsByClassName(t.substr(1))[0];else{if("#"!==t.charAt(0))return console.log("Pie chart element is not correctly defined."),null;a=document.getElementById(t.substr(1))}var r=a.getContext("2d"),s=[],o=[],n=[];return e.forEach(function(e){o.push(e.browser),n.push(parseInt(e.sessions)),s.push(getRandomHexColor())}),new Chart(r,{type:"doughnut",data:{labels:o,datasets:[{backgroundColor:s,data:n}],options:{segmentShowStroke:!0,segmentStrokeColor:"#fff",segmentStrokeWidth:2,percentageInnerCutout:50,animationSteps:100,animationEasing:"easeOutBounce",animateRotate:!0,animateScale:!1,responsive:!0,maintainAspectRatio:!0}}})}}function getCountriesAndVisitorsAjax(e,t){var a={status:"error",message:"",code:""};if(null!==e&&null!==t){var r=laroute.route("stats.countries-and-visitors",{dateFrom:e,dateTo:t});return $.get(r,function(e){return e.data}).promise()}return r=laroute.route("stats.countries-and-visitors",{dateFrom:e,dateTo:t}),a.message="Both dates cannot be null / empty.",a.code=500,$.get(r,function(){return a}).promise()}function generateGoogleGeoChart(e,t){var a;if("."===t.charAt(0))a=document.getElementsByClassName(t.substr(1))[0];else{if("#"!==t.charAt(0))return console.log("Pie chart element is not correctly defined."),null;a=document.getElementById(t.substr(1))}google.charts.load("current",{packages:["geochart"],mapsApiKey:"AIzaSyD-9tSrke72PouQMnMX-a7eZSW0jkFMBWY"});for(var r=0;r<e.length;r++)isNaN(e[r][1])||(e[r][1]=parseInt(e[r][1]));var s=e,o=function(){a.innerHTML="";var e=google.visualization.arrayToDataTable(s),t={};t.width="90%",t.showLegend=!0,t.showZoomOut=!0,t.zoomOutLabel="Zoom Out";new google.visualization.GeoChart(a).draw(e,t)};google.charts.setOnLoadCallback(o);var n;jQuery(window).on("resize",function(){clearTimeout(n),n=setTimeout(function(){o()},250)}),jQuery(window).on("reload",function(){clearTimeout(n),n=setTimeout(function(){o()},250)})}$(function(){$.fn.dataTable.ext.errMode="none",$.ajaxSetup({timeout:36e5,cache:!1,crossDomain:!0,xhrFields:{withCredentials:!0},beforeSend:function(e,t){var a=Cookies.get("XSRF-TOKEN");e.setRequestHeader("X-Requested-With","XMLHttpRequest"),e.setRequestHeader("X-XSRF-Token",a)}});var e=currentDate(),t=dateFormatted(alterDate(currentDate().date,-6)),a=$("#date-from-display"),r=$("#date-to-display");a.text(t.fullDisplay),r.text(e.fullDisplay);var s=$("#from-date");s.val(t.dateFormatted);var o=$("#to-date");o.val(e.dateFormatted),s.prop("placeholder",t),o.prop("placeholder",e),s.datepicker({numberOfMonths:2,dateFormat:"dd-mm-yy",onSelect:function(e){var t=new Date(e);t.setDate(t.getDate()),o.datepicker("option",null,dateFormatted(t).dateFormatted)}}),o.datepicker({numberOfMonths:2,dateFormat:"dd-mm-yy",onSelect:function(e){var t=new Date(e);t.setDate(t.getDate()),s.datepicker("option",null,dateFormatted(t).dateFormatted)}});var n="visitors area chart",i=getVisitorsDataAjax("stats.visits-and-page-views",s.val(),o.val(),500),l=generateProgressBar("#areaChart-progressbar",n);renderVisitorsAreaChart(i,"#areaChart","#areaChart-container","20em",l);var d="visitors datatable",u=getVisitorsDataAjax("stats.top-pages-between-dates",s.val(),o.val(),500),g=generateProgressBar("#visitorsTable-progressbar",d);renderVisitorsDataTable(u,"#visitorsTable",g);var c="visitors geo chart",p=getCountriesAndVisitorsAjax(s.val(),o.val()),m=generateProgressBar("#countriesMap-progressbar",c);renderVisitorsGoogleMap(p,"#regions_div",m,"100%","auto");var v="visitors' browsers chart",b=getBrowserStatsAjax("stats.top-x-browsers",s.val(),o.val(),10),f=generateProgressBar("#pieChart-progressbar",v);renderBrowserStatsPieChart(b,"#pieChart","#pieChart-container","35em",f),$("#stats-form").submit(function(e){e.preventDefault();var t=$("#from-date").val(),i=$("#to-date").val(),l=Number.parseInt(t.substr(0,2)),u=Number.parseInt(t.substr(3,5)),g=Number.parseInt(t.substr(6)),p=Number.parseInt(i.substr(0,2)),m=Number.parseInt(i.substr(3,5)),b=Number.parseInt(i.substr(6)),f=new Date(g,u-1,l),h=new Date(b,m-1,p);void 0!==f&&void 0!==h&&(a.text(dateFormatted(f).fullDisplay),r.text(dateFormatted(h).fullDisplay));var y=getVisitorsDataAjax("stats.visits-and-page-views",t,i,500),C=generateProgressBar("#areaChart-progressbar",n);renderVisitorsAreaChart(y,"#areaChart","#areaChart-container","20em",C,!0);var S=getVisitorsDataAjax("stats.top-pages-between-dates",t,i,500),w=generateProgressBar("#visitorsTable-progressbar",d);renderVisitorsDataTable(S,"table#visitorsTable",w,!0);var D=getCountriesAndVisitorsAjax(s.val(),o.val()),x=generateProgressBar("#countriesMap-progressbar",c);renderVisitorsGoogleMap(D,"#regions_div",x,"100%","auto",!0);var V=getBrowserStatsAjax("stats.top-x-browsers",s.val(),o.val(),10),A=generateProgressBar("#pieChart-progressbar",v);renderBrowserStatsPieChart(V,"#pieChart","#pieChart-container","35em",A,!0)})});