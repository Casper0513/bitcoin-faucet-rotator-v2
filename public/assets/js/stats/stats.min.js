function generateVisitorsTable(e,t){if(void 0!==e&&void 0!==$(t))return $(t).DataTable({processing:!0,data:e,language:{processing:"Loading..."},order:[[1,"desc"],[2,"desc"],[3,"desc"],[4,"desc"],[5,"desc"],[6,"asc"],[7,"desc"]],columns:[{data:"url",type:"string",render:{_:function(e){var t='<a href="'+e.display+'" title="'+e.original+'">';return t+=e.original+"</a>"},sort:"original"}},{data:"uniqueVisitors",type:"num",render:{_:"display",sort:"original"}},{data:"pageViews",type:"num",render:{_:"display",sort:"original"}},{data:"uniquePageViews",type:"num",render:{_:"display",sort:"original"}},{data:"aveSessionDuration",type:"num",render:{_:"display",sort:"original"}},{data:"aveTimeOnPage",type:"num",render:{_:"display",sort:"original"}},{data:"noOfBounces",type:"num",render:{_:"display",sort:"original"}},{data:"noOfCountries"}],responsive:!0,scrollX:!0,fnStateSave:function(e,t){localStorage.setItem("VisitorsDataTable",JSON.stringify(t))},fnStateLoad:function(e){return JSON.parse(localStorage.getItem("VisitorsDataTable")).iStart=0,e}})}function generateVisitorsLineChart(e,t){var a=getRandomRgb(),r=getRandomRgb();if(void 0!==e&&"error"!==e.status&&void 0!==$(t)[0]){var s=$(t)[0].getContext("2d"),o=[],n=[],i=[];e.forEach(function(e){o.push(new Date(e.date).formatDDMMYYYY()),n.push(parseInt(e.visitors)),i.push(parseInt(e.pageViews))});var l={type:"line",data:{labels:o,datasets:[{label:"Visitors",borderColor:rgbaString(a.r,a.g,a.b),backgroundColor:rgbaString(a.r,a.g,a.b,.5),data:n},{label:"Page views",borderColor:rgbaString(r.r,r.g,r.b),backgroundColor:rgbaString(r.r,r.g,r.b,.5),data:i}]},options:{showScale:!0,scaleShowGridLines:!0,scaleGridLineColor:"rgba(0,0,0,.05)",scaleGridLineWidth:1,scaleShowHorizontalLines:!0,scaleShowVerticalLines:!0,bezierCurve:!0,bezierCurveTension:.8,pointDot:!1,pointDotRadius:4,pointDotStrokeWidth:1,pointHitDetectionRadius:20,datasetStroke:!0,datasetStrokeWidth:2,datasetFill:!0,maintainAspectRatio:!0,responsive:!0,tooltips:{mode:"index",intersect:!1,callbacks:{label:function(e,t){return 0===e.datasetIndex?"Visitors: "+e.yLabel.toString():1===e.datasetIndex?"Page Views: "+e.yLabel.toString():void 0}}},scales:{yAxes:[{scaleLabel:{display:!0,labelString:"Number of Visitors / Page Views"}}],xAxes:[{scaleLabel:{display:!0,labelString:"Date"}}]}}};return new Chart(s,l)}}function getVisitorsDataAjax(e,t,a,r){if(null===r&&(r=10),null!==e&&null!==t&&null!==a){var s=laroute.route(e,{dateFrom:t,dateTo:a,quantity:r});return void 0===s?null:$.get(s,function(e){return e.data}).promise()}}function getBrowserStatsAjax(e,t,a,r){if(null===r&&(r=10),null!==e&&null!==t&&null!==a){var s=laroute.route(e,{dateFrom:t,dateTo:a,maxBrowsers:r});return $.get(s,function(e){return e.data}).promise()}}function generatePieDonutChart(e,t){if(void 0!==e&&void 0!==$(t)){var a;if("."===t.charAt(0))a=document.getElementsByClassName(t.substr(1))[0];else{if("#"!==t.charAt(0))return console.log("Pie chart element is not correctly defined."),null;a=document.getElementById(t.substr(1))}var r=a.getContext("2d"),s=[],o=[],n=[];return e.forEach(function(e){o.push(e.browser),n.push(parseInt(e.sessions)),s.push(getRandomHexColor())}),new Chart(r,{type:"doughnut",data:{labels:o,datasets:[{backgroundColor:s,data:n}],options:{segmentShowStroke:!0,segmentStrokeColor:"#fff",segmentStrokeWidth:2,percentageInnerCutout:50,animationSteps:100,animationEasing:"easeOutBounce",animateRotate:!0,animateScale:!1,responsive:!0,maintainAspectRatio:!0}}})}}function getCountriesAndVisitorsAjax(e,t){var a={status:"error",message:"",code:""};if(null===e||null===t)return r=laroute.route("stats.countries-and-visitors",{dateFrom:e,dateTo:t}),a.message="Both dates cannot be null / empty.",a.code=500,$.get(r,function(){return a}).promise();var r=laroute.route("stats.countries-and-visitors",{dateFrom:e,dateTo:t});return $.get(r,function(e){return e.data}).promise()}function generateGoogleGeoChart(e,t){var a;if("."===t.charAt(0))a=document.getElementsByClassName(t.substr(1))[0];else{if("#"!==t.charAt(0))return console.log("Pie chart element is not correctly defined."),null;a=document.getElementById(t.substr(1))}google.charts.load("current",{packages:["geochart"],mapsApiKey:"AIzaSyD-9tSrke72PouQMnMX-a7eZSW0jkFMBWY"});for(var r=0;r<e.length;r++)isNaN(e[r][1])||(e[r][1]=parseInt(e[r][1]));function s(){a.innerHTML="";var e=google.visualization.arrayToDataTable(n),t={width:"90%",showLegend:!0,showZoomOut:!0,zoomOutLabel:"Zoom Out"};new google.visualization.GeoChart(a).draw(e,t)}var o,n=e;google.charts.setOnLoadCallback(s),jQuery(window).on("resize",function(){clearTimeout(o),o=setTimeout(function(){s()},250)}),jQuery(window).on("reload",function(){clearTimeout(o),o=setTimeout(function(){s()},250)})}$(function(){$.fn.dataTable.ext.errMode="none",$.ajaxSetup({timeout:36e5,cache:!1,crossDomain:!0,xhrFields:{withCredentials:!0},beforeSend:function(e,t){var a=Cookies.get("XSRF-TOKEN");e.setRequestHeader("X-Requested-With","XMLHttpRequest"),e.setRequestHeader("X-XSRF-Token",a)}});var e=currentDate(),t=dateFormatted(alterDate(currentDate().date,-6)),y=500,C=$("#date-from-display"),S=$("#date-to-display");C.text(t.fullDisplay),S.text(e.fullDisplay);var w=$("#from-date");w.val(t.dateFormatted);var D=$("#to-date");D.val(e.dateFormatted),w.prop("placeholder",t),D.prop("placeholder",e),w.datepicker({numberOfMonths:2,dateFormat:"dd-mm-yy",onSelect:function(e){var t=new Date(e);t.setDate(t.getDate()),D.datepicker("option",null,dateFormatted(t).dateFormatted)}}),D.datepicker({numberOfMonths:2,dateFormat:"dd-mm-yy",onSelect:function(e){var t=new Date(e);t.setDate(t.getDate()),w.datepicker("option",null,dateFormatted(t).dateFormatted)}});var x="visitors area chart",a=getVisitorsDataAjax("stats.visits-and-page-views",w.val(),D.val(),y),r=generateProgressBar("#areaChart-progressbar",x);renderVisitorsAreaChart(a,"#areaChart","#areaChart-container","20em",r);var V="visitors datatable",s=getVisitorsDataAjax("stats.top-pages-between-dates",w.val(),D.val(),y),o=generateProgressBar("#visitorsTable-progressbar",V);renderVisitorsDataTable(s,"#visitorsTable",o);var A="visitors geo chart",n=getCountriesAndVisitorsAjax(w.val(),D.val()),i=generateProgressBar("#countriesMap-progressbar",A);renderVisitorsGoogleMap(n,"#regions_div",i,"100%","auto");var T="visitors' browsers chart",l=getBrowserStatsAjax("stats.top-x-browsers",w.val(),D.val(),10),d=generateProgressBar("#pieChart-progressbar",T);renderBrowserStatsPieChart(l,"#pieChart","#pieChart-container","35em",d),$("#stats-form").submit(function(e){e.preventDefault();var t=$("#from-date").val(),a=$("#to-date").val(),r=Number.parseInt(t.substr(0,2)),s=Number.parseInt(t.substr(3,5)),o=Number.parseInt(t.substr(6)),n=Number.parseInt(a.substr(0,2)),i=Number.parseInt(a.substr(3,5)),l=Number.parseInt(a.substr(6)),d=new Date(o,s-1,r),u=new Date(l,i-1,n);void 0!==d&&void 0!==u&&(C.text(dateFormatted(d).fullDisplay),S.text(dateFormatted(u).fullDisplay));var g=getVisitorsDataAjax("stats.visits-and-page-views",t,a,y),c=generateProgressBar("#areaChart-progressbar",x);renderVisitorsAreaChart(g,"#areaChart","#areaChart-container","20em",c,!0);var p=getVisitorsDataAjax("stats.top-pages-between-dates",t,a,y),m=generateProgressBar("#visitorsTable-progressbar",V);renderVisitorsDataTable(p,"table#visitorsTable",m,!0);var v=getCountriesAndVisitorsAjax(w.val(),D.val()),b=generateProgressBar("#countriesMap-progressbar",A);renderVisitorsGoogleMap(v,"#regions_div",b,"100%","auto",!0);var f=getBrowserStatsAjax("stats.top-x-browsers",w.val(),D.val(),10),h=generateProgressBar("#pieChart-progressbar",T);renderBrowserStatsPieChart(f,"#pieChart","#pieChart-container","35em",h,!0)})});